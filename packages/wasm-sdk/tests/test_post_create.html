<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Post Creation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            color: red;
        }
        .success {
            color: green;
        }
    </style>
</head>
<body>
    <h1>Test Post Creation</h1>
    
    <div class="form-group">
        <label>Identity ID:</label>
        <input type="text" id="identityId" value="5DbLwAxGBzUzo81VewMUwn4b5P4bpv9FNFybi25XB5Bk">
    </div>
    
    <div class="form-group">
        <label>Private Key (WIF):</label>
        <input type="password" id="privateKey" value="XK6CFyvYUMvY9FVQLeYBZBFDbC4QuBLiqWMAFxBVZcMHJ5eARJtf">
    </div>
    
    <div class="form-group">
        <label>Contract ID:</label>
        <input type="text" id="contractId" value="9nzpvjVSStUrhkEs3eNHw2JYpcNoLh1MjmqW45QiyjSa">
    </div>
    
    <div class="form-group">
        <label>Post Content:</label>
        <textarea id="content" rows="3">This is the first post created with the WASM SDK!</textarea>
    </div>
    
    <div class="form-group">
        <label>Primary Hashtag (optional):</label>
        <input type="text" id="primaryHashtag" placeholder="e.g., new">
    </div>
    
    <div class="form-group">
        <label>Language (optional):</label>
        <input type="text" id="language" placeholder="e.g., en" maxlength="2">
    </div>
    
    <button onclick="createPost()">Create Post</button>
    
    <div id="result"></div>

    <script type="module">
        import init, { WasmSdkBuilder } from './pkg/wasm_sdk.js';
        
        let sdk = null;
        
        async function initSDK() {
            await init();
            const builder = new WasmSdkBuilder();
            builder.set_testnet_mode();
            sdk = builder.build();
            window.sdk = sdk;
            console.log('SDK initialized');
        }
        
        window.createPost = async function() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = 'Creating post...';
            resultDiv.className = '';
            
            try {
                const identityId = document.getElementById('identityId').value;
                const privateKey = document.getElementById('privateKey').value;
                const contractId = document.getElementById('contractId').value;
                const content = document.getElementById('content').value;
                const primaryHashtag = document.getElementById('primaryHashtag').value;
                const language = document.getElementById('language').value;
                
                // Build document data object
                const documentData = {
                    content: content
                };
                
                // Add optional fields if provided
                if (primaryHashtag) {
                    documentData.primaryHashtag = primaryHashtag;
                }
                if (language) {
                    documentData.language = language;
                }
                
                // Generate entropy
                const entropy = new Uint8Array(32);
                crypto.getRandomValues(entropy);
                const entropyHex = Array.from(entropy)
                    .map(b => b.toString(16).padStart(2, '0'))
                    .join('');
                
                console.log('Document data:', documentData);
                console.log('Document data JSON:', JSON.stringify(documentData));
                
                // Create the post
                const result = await sdk.documentCreate(
                    contractId,
                    'post',
                    identityId,
                    JSON.stringify(documentData),
                    entropyHex,
                    privateKey
                );
                
                resultDiv.innerHTML = 'Success!\n' + JSON.stringify(result, null, 2);
                resultDiv.className = 'success';
                
            } catch (error) {
                console.error('Error:', error);
                resultDiv.innerHTML = 'Error: ' + (error.message || error);
                resultDiv.className = 'error';
            }
        };
        
        // Initialize on load
        initSDK().catch(console.error);
    </script>
</body>
</html>