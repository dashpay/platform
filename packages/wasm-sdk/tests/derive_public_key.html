<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Derive Public Key</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        #result {
            margin-top: 20px;
            padding: 10px;
            background-color: #f5f5f5;
            border-radius: 4px;
            font-family: monospace;
            word-break: break-all;
        }
        .key-section {
            margin: 10px 0;
            padding: 10px;
            background-color: #e8f4f8;
            border-radius: 4px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bitcore-lib-dash@8.25.45/bitcore-lib-dash.min.js"></script>
</head>
<body>
    <h1>Derive Public Key from Private Key</h1>
    
    <div class="form-group">
        <label>Private Key (WIF):</label>
        <input type="text" id="privateKey" value="XK6CFyvYUMvY9FVQLeYBZBFDbC4QuBLiqWMAFxBVZcMHJ5eARJtf">
    </div>
    
    <button onclick="deriveKey()">Derive Public Key</button>
    
    <div id="result"></div>

    <script>
        function deriveKey() {
            const resultDiv = document.getElementById('result');
            const privateKeyWif = document.getElementById('privateKey').value;
            
            try {
                // Use bitcore-lib-dash to handle the key
                const dashcore = require('bitcore-lib-dash');
                
                // Create private key from WIF
                const privateKey = new dashcore.PrivateKey(privateKeyWif);
                
                // Get public key
                const publicKey = privateKey.toPublicKey();
                
                // Get the compressed public key bytes (33 bytes)
                const publicKeyBytes = publicKey.toBuffer();
                const publicKeyHex = publicKeyBytes.toString('hex');
                
                resultDiv.innerHTML = '<div class="key-section">';
                resultDiv.innerHTML += '<h3>Private Key Info:</h3>';
                resultDiv.innerHTML += 'WIF: ' + privateKeyWif + '<br>';
                resultDiv.innerHTML += 'Network: ' + privateKey.network.name + '<br><br>';
                
                resultDiv.innerHTML += '<h3>Public Key Info:</h3>';
                resultDiv.innerHTML += 'Compressed Public Key (hex): ' + publicKeyHex + '<br>';
                resultDiv.innerHTML += 'Public Key Length: ' + publicKeyBytes.length + ' bytes<br>';
                resultDiv.innerHTML += 'Is Compressed: ' + publicKey.compressed + '<br><br>';
                
                // Convert to base64 for comparison with identity keys
                const publicKeyBase64 = btoa(String.fromCharCode.apply(null, publicKeyBytes));
                resultDiv.innerHTML += 'Public Key (base64): ' + publicKeyBase64 + '<br><br>';
                
                resultDiv.innerHTML += '<h3>Instructions:</h3>';
                resultDiv.innerHTML += '1. Copy the base64 public key above<br>';
                resultDiv.innerHTML += '2. Go to the Check Identity Keys page<br>';
                resultDiv.innerHTML += '3. Compare this public key with the "data" field of authentication keys<br>';
                resultDiv.innerHTML += '4. They should match exactly for the key to work<br>';
                resultDiv.innerHTML += '</div>';
                
            } catch (error) {
                resultDiv.innerHTML = '<div style="color: red;">Error: ' + error.message + '</div>';
                console.error('Error:', error);
            }
        }
    </script>
</body>
</html>