<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Identity Nonce</title>
</head>
<body>
    <h1>Identity Nonce Test</h1>
    <pre id="output"></pre>
    
    <script type="module">
        import init, { WasmSdkBuilder, get_identity_balance, get_identity_nonce } from '../pkg/wasm_sdk.js';
        
        const output = document.getElementById('output');
        
        async function test() {
            await init();
            
            const builder = WasmSdkBuilder.testnet();
            const sdk = await builder.with_cache(false).build();
            
            const identity_id = "5DbLwAxGBzUzo81VewMUwn4b5P4bpv9FNFybi25XB5Bk";
            
            output.textContent = "Testing identity: " + identity_id + "\n\n";
            
            try {
                // Test balance
                output.textContent += "Fetching balance...\n";
                const balance = await get_identity_balance(sdk, identity_id);
                output.textContent += "Balance: " + JSON.stringify(balance, null, 2) + "\n\n";
                
                // Test nonce
                output.textContent += "Fetching nonce...\n";
                const nonce = await get_identity_nonce(sdk, identity_id);
                output.textContent += "Nonce: " + JSON.stringify(nonce, null, 2) + "\n\n";
                
                // Compare values
                if (balance.balance === nonce.nonce) {
                    output.textContent += "ERROR: Balance and nonce are the same! (" + balance.balance + ")\n";
                    output.textContent += "This suggests the bug is NOT fixed.\n";
                } else {
                    output.textContent += "SUCCESS: Balance and nonce are different!\n";
                    output.textContent += "Balance: " + balance.balance + "\n";
                    output.textContent += "Nonce: " + nonce.nonce + "\n";
                    output.textContent += "The bug appears to be fixed.\n";
                }
            } catch (e) {
                output.textContent += "Error: " + e.message + "\n";
            }
        }
        
        test().catch(console.error);
    </script>
</body>
</html>