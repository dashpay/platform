#include <stdio.h>
#include <assert.h>
#include "../target/drive.h"
#include "./utils.c"

void test_verify_full_identity_by_public_key_hash() {
    char *proof_hex = "06000100a603014a75cf3f535e81c4680f8137a2208dbcb2652ffd7e715bd4290cc5c560b2cc6102cfbe0535bd2defe586b863b9ccb92d0d66fb2b810d730e7ba2cb7e2fb302613b100401180018020114aee302720896bba837dcf3f2d674f546fd25496f00ca359aa1b2032e3158ae5e5c489f7d46722f29644a15e1cf7c3935b30606def61104012000240201203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200a0d5a4f6418663468515cd75189be3e1034bbfa9a1807eb81d964ba7442a0b1e100169931838564707dbf11e90a059fd7dd453cc7e68adb7d2c2375bae53566664e711025670752cc3d883200a7598b65cd74b41a760cc0be57cda5536f15f03c8783aa81001c33635136e502e9ac5244b15a20a757e0759ce0a90823cd37f893f6a49556d26040160002d0401203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2fd1cb12a5b2614000000fbbd3be097e7f07d5619dd69e7767884d116f95ae9a5fcdb651e71727902cc1e10011e0c1443d0925f781132f4c506747202dbffa3ca3ded4d2387d4b7e40e0303e311110201187f03144463a1a994d5040e69c090b6985d7af295bfd11a002300203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200029e6f2d33b1580030e3b6030e3c25016ab7253965682556059dcc243b75c7fa6d1001e09f88cd09cc595d524892b3e642b939f2827995605703c49c861f653001d5e1110101204d04203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200090201010201030000007fae89b888b23f4fbdaed2fb990a1f42727aef5bd2a8b91f8cb970570909ab3901203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a27f030100000b000800000000000000100004010100050201010100d651221796b5206a5b9678a4d9995d519d8b9e75e87d85e57effb91f82a23e8d1002bcf84a882c0f72dd0d520a6954b3e1887fa55b7dc67635b44516856b31fd20a8100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100001e001b0000010200144463a1a994d5040e69c090b6985d7af295bfd11a0000030101003a0037010002010030973988b291fd1bca86d906723e335bdf13d3ebbadfea31dd164b3c672c16da72af8e6edfc0bac44b92b8c536d708dc33000010030102002b00280200030000210360da79c58995e4ec88512af9a4440ca4f2d7bfe84240e17effc4dd8ce94033a20000110201604f04203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2000b03fd1cb12a5b261400000068f31829eaec02f7e5eddada129d4981a99bda0e5c0fd4eff3c23eafc2c79a02";
    char *pub_key_hex = "4463a1a994d5040e69c090b6985d7af295bfd11a";

    unsigned char *proof_bin = hex2bin(proof_hex);
    unsigned char *pub_key_bin = hex2bin(pub_key_hex);

    IdentityVerificationResult *result = verify_full_identity_by_public_key_hash(proof_bin, 1038, pub_key_bin);
    assert(result->is_valid);

    uint8_t expected_root_hash[32] = {72,72,215,200,156,21,128,156,166,182,110,57,113,232,229,242,193,199,240,135,222,102,246,165,181,68,81,221,120,195,236,199};
    assert(is_array_equal(result->root_hash, expected_root_hash,32));

    assert(result->has_identity);

    Identity *identity = result->identity;
    assert(identity->protocol_version == 1);

    uint8_t id[32] = {62, 171, 130, 51, 233, 19, 45, 191, 194, 183, 0, 171, 182, 77, 93, 70, 216, 67, 22, 47, 39, 25, 156, 146, 35, 108, 99, 133, 34, 187, 243, 162};
    assert(is_array_equal(*identity->id, id, 32));

    // Confirm identity has 3 public keys
    assert(identity->public_keys_count == 3);

    // Assert on the first public key
    assert(identity->public_keys[0]->key == 0);
    IdentityPublicKey *first = identity->public_keys[0]->public_key;
    assert(first->id == 0);
    assert(first->purpose == 0);
    assert(first->security_level == 1);
    assert(first->key_type == 2);
    assert(first->read_only == false);
    assert(first->has_disabled_at == false);
    uint8_t first_public_key[20] = {68, 99, 161, 169, 148, 213, 4, 14, 105, 192, 144, 182, 152, 93, 122, 242, 149, 191, 209, 26};
    assert(is_array_equal(first->data, first_public_key, first->data_length));

    // Assert on the second public key
    assert(identity->public_keys[1]->key == 1);
    IdentityPublicKey *second = identity->public_keys[1]->public_key;
    assert(second->id == 1);
    assert(second->purpose == 0);
    assert(second->security_level == 2);
    assert(second->key_type == 1);
    assert(second->read_only == false);
    assert(second->has_disabled_at == false);
    unsigned char second_public_key[50] = {151, 57, 136, 178, 145, 253, 27, 202, 134, 217, 6, 114, 62, 51, 91, 223, 19, 211, 235, 186, 223, 234, 49, 221, 22, 75, 60, 103, 44, 22, 218, 114, 175, 142, 110, 223, 192, 186, 196, 75, 146, 184, 197, 54, 215, 8, 220, 51};
    assert(is_array_equal(second->data,second_public_key, second->data_length));

    // Assert on the third public key
    assert(identity->public_keys[0]->key == 0);
    IdentityPublicKey *third = identity->public_keys[2]->public_key;
    assert(third->id == 2);
    assert(third->purpose == 0);
    assert(third->security_level == 3);
    assert(third->key_type == 0);
    assert(third->read_only == false);
    assert(third->has_disabled_at == false);
    unsigned char third_public_key[33] = {3, 96, 218, 121, 197, 137, 149, 228, 236, 136, 81, 42, 249, 164, 68, 12, 164, 242, 215, 191, 232, 66, 64, 225, 126, 255, 196, 221, 140, 233, 64, 51, 162};
    assert(is_array_equal(third->data,third_public_key, third->data_length));

    assert(identity->balance == 11077485418638);
    assert(identity->revision == 16);
    assert(!identity->has_metadata);
    assert(!identity->has_asset_lock_proof);

}

void test_verify_full_identities_by_public_key_hashes() {
    char *multiple_identity_proof_hex = "06000100a603014a75cf3f535e81c4680f8137a2208dbcb2652ffd7e715bd4290cc5c560b2cc6102cfbe0535bd2defe586b863b9ccb92d0d66fb2b810d730e7ba2cb7e2fb302613b1004011800180201145e0e49d808ad21d01d07dd799a75bd1b472788a7008c10aa4c1d19e2e7e42fe0b1a7f6d93d4c0b6992ef63ea985c16447cada4629511040120002402012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000ba56cfb1d87ef47857f6b1cd7fb918406fd50f81966619777dd4c1b595a1a26e100169931838564707dbf11e90a059fd7dd453cc7e68adb7d2c2375bae53566664e711025670752cc3d883200a7598b65cd74b41a760cc0be57cda5536f15f03c8783aa81001c33635136e502e9ac5244b15a20a757e0759ce0a90823cd37f893f6a49556d26040160002d04012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30fdbafd6833aeb700000012b27f4a0a7cfd06e3387b33a5bca6682953512e21621ae9cf6d633d9041771910011e0c1443d0925f781132f4c506747202dbffa3ca3ded4d2387d4b7e40e0303e31111020118b3080132c9d35844d5ce2a8e0f377cee23c143a53396073dea86c494b86ba4c4af0b3903141f0815269afc012de44260ceb28a4496d3184184002300200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb00100168576e24521e03ba4b624912bb07833767c81102310b87d8ea1caf2795c68f921102e8b7eb376f0f7993badf93971f690be8a48f09db0711f052a2ed48471497b9d01003144463a1a994d5040e69c090b6985d7af295bfd11a002300203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a20002254bf0a990beb721c21f21e8dbab50e33cd9cf09618fc27c9f7450c673516aee1001c6adfe081809218ee07461f95f53ce6ce462ec379f97a71f1be40f7218cb50af111103145e0e49d808ad21d01d07dd799a75bd1b472788a70023002035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30001001a4b31998d47c30e390f4fa56f28f19c62f114f17a704d29c56e28b6fdb47f101031467892af390cd2b7653a918c7b692c85b87b44d3200230020399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80001001eb4da977338a3da4204eaaac0c8856bdfd51d9b25ceef04b40bb38eff79ab11011021f22102429dbe1bc0ca714847b08187d9a874cc43329aaa79647fb9aa0834d691003149a061f31734c5f5f0b119ab72d433c9af133d3a600230020e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330002644c601e67692188cf5a975c2207caba899d99f1bbd4b62e5fe856850b9d7286100314a54921bb29b67e31898efebc29f241b1aefa4dca002300207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e510010029e6f2d33b1580030e3b6030e3c25016ab7253965682556059dcc243b75c7fa6d0314b3bfce478de96fe30cd3713bf88ce7728687da8a00230020a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40001111110314bb3df025e32fd90d1feee7dca4b83321c683292d0023002003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3001001ee0847805b145b5fb500b139fe12767ee681fc310a21d6e9814619df5187470802a0de352fe6767da7bf4c33ba7d2da8db0440457835d3c2992473210e02b6312c1001e09f88cd09cc595d524892b3e642b939f2827995605703c49c861f653001d5e1029a563c983d202520c1a94f4c6ba99750373450aaf9dcb2a62ef50e9877646043100314ed738aaadd75d1677fefeccadd033f126cfee76a0023002097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000314fbd9daa5993de56a2e4346b7c72ff5585efffaab002300201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb0010111111110101208b06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d300090201010201030000006c4bfcf223cd4fe5c1cac82e1a9e2c73eb0e7f34cebabdd7630e24cb192f975804200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000902010102010300000080da62acb8c49f901d6bf84a2a2af15431e69e29069abf8d02f2c113c6099ba61004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000902010102010300000051a23049efbcde3a0e9c85ea7af05a28d4de31f90ae44a07c5fa18090128237011042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000090201010201030000002a390761b997897afe51540c39dfeb5c78d00781a547d2b83b1e72259894dea5100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f800009020101020103000000b3f28f9cc26df90ea49e13e3cd97c01d772e9d6609453e91d4369ef78e3880a004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200090201010201030000007fae89b888b23f4fbdaed2fb990a1f42727aef5bd2a8b91f8cb970570909ab391004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e5100090201010201030000001d64a3f9270bf8b8104305ba76829472f3aac2b6fff20b98ac10361ec5473fbb11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef0009020101020103000000adb76570d64f89650686df5819414e5e42cf7eedab24605aa63c4b8e26e90eda100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be400009020101020103000000a5a8530416d9462521b6fd932723d8971684b4620e4254caf09c75289e0e64700420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330009020101020103000000fa1d907f967c48292a5af3d4c3aad435c2ee9237119614d612aee3b4f52e3614111111012003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d37f030100000b0008000000000000003d000401010005020101010072cc451270c61384d358f7d41135b78788011830301a697b97a3714c203a36dc100214105bdf191491b67249d321f3d9bebdf82c9a3395fef336c60b3701af0593e7100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b000002030014bb3df025e32fd90d1feee7dca4b83321c683292d0000030101003a0037010001010030a5fd02c96d5f60eb54b15b043a84ed80a0af804eff4a2bfea1fc9fed323232c7ab12072368097e556439d08aa0a6866c000010030102003a003702000001003085ff00e6339367d3e31e27cbc33c13c3cd0c6e973a5b902e76668d7a6daf83c129257cc7f9cc35e1c0689a6df03a891d00001101200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb7f030100000b000800000000000000030004010100050201010100783a62676dbffd012f9343ef0af71c1b800cda19801689dfb7e2372cccc3ed9d10027f0e94e54c63ffdcd3d3d9017a63e82f9984ade5c4faa59d2479c11007932524100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df1102010178030100002b002800000200002103fe65fcdcfe242dc2e43d654274ec9ce1bbbc9dd5a1c88945eeef18cc93151f7f0000030101001e001b010001030014c94f46cf38b83862990f782c84acbc178d7b02da000010030102001e001b02000203001426d387d9884862f96160dd59ca596bdce82da74600001101201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb7f030100000b000800000000000000600004010100050201010100ca3a10eab3b889465bba51bc5354131aee1044e510d9ed4a7068d1181c7dbfcd10029626ec2b4e8861c675b20bc4456333d8c41fd0c0b9c9f0b78047c6634ebab8ef100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100001e001b000003020014fbd9daa5993de56a2e4346b7c72ff5585efffaab0000030101002b002801000300002103fdc9403eb6f005db700e7841627f4f92e7c65d167384cd57a4f4e46583c21afe000010030102002b002802000000002103703446f77c8db1fbac6f3422c8e045098adb662c0b620a15b8c4d9ecd2a3defa000011012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c307f030100000b000800000000000000420004010100050201010100d7f397a816f23f32e9a6cd2ab5b03d5b6d30742cf0b58517f276d9f75c1c4d611002bfd5686ae0d2a7684c2f6ed3a7419a436a5389afc9a84a1bb22a1decdfa7625d100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b0000020300145e0e49d808ad21d01d07dd799a75bd1b472788a70000030101003a003701000001003097c8d8102d216818c693dc46614ce9242b8e54e05a8ff1f520a3694b9481091d92906b13b9b2762b127ee4f07e91119e000010030102003a00370200030100308949c96dda849268044e176dbdba458fb5deac81e9918793bdb837f5afee0c2496a5930d46d1fe37ce536cbef8e95bb40000110120399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f807f030100000b0008000000000000000c0004010100050201010100a9403aa408af35d267980dfff1706d70a59b6dba867d0b568ca8c5b77560d67a100276cbfe822d7b9f6863f9a06b668097458e123ff385e31c29d830d03f1148973a100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100003a0037000000010030b79d4caa865f84207124c3d304430372f39d7c18a237df3a71e3c4fb7ba9ab9816439a809beb8606c3bb52d53a5364590000030101001e001b0100030200146406a5082b231340726d4cd0de2452bc73a33003000010030102001e001b0200010300144ac7b42f524e1d1b22098f85adfca752600ef9a000001101203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a27f030100000b000800000000000000100004010100050201010100d651221796b5206a5b9678a4d9995d519d8b9e75e87d85e57effb91f82a23e8d1002bcf84a882c0f72dd0d520a6954b3e1887fa55b7dc67635b44516856b31fd20a8100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100001e001b0000010200144463a1a994d5040e69c090b6985d7af295bfd11a0000030101003a0037010002010030973988b291fd1bca86d906723e335bdf13d3ebbadfea31dd164b3c672c16da72af8e6edfc0bac44b92b8c536d708dc33000010030102002b00280200030000210360da79c58995e4ec88512af9a4440ca4f2d7bfe84240e17effc4dd8ce94033a200001101207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e517f030100000b000800000000000000580004010100050201010100d95ff983db933edc675487a6f4e388fcf2db59313aeab5f45991a7f2471774471002355f98c38fd87ca5775e5e451243eb11300ed91fc950ea204c0a74b9a1991a25100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100003a0037000003010030b3423844bae8a591bbfb437b55566b5d61e54ee64f93351b0a3b9d4b731445d25ce367f7aedfcb32bd3cd14308a54cf50000030101003a0037010001010030a154c19082ac6b5fec72b81f6488550fec7149d52f66b4463915a61179c4f1f8507d366614b454dabf2c942235caad01000010030102001e001b0200030300140a8c14745c982f9fdc43aa985c02b1e5bff6c403000011012097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef7f030100000b000800000000000000620004010100050201010100412c1e7de2394dcd009223eb8c3a24e34b93a7c48df0bb86499160a31ea9dbdb1002180590eec33397034675f379cf17f62c0e77d17724a03238dcd3f216a4bc9509100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100003a0037000002010030afa4370aa5a48ab2f3ab510ccaba3b6d8cf51752304507e6a341c4e4ff6aa7c07610a503b42f479834b032d25dd160590000030101002b002801000300002103a9584c4580d165d2744ba49a70472653915bfdbec4bef471e26ce4c1c9e6c6ab000010030102001e001b02000102001445d04558a26b8ca04b486957c8abf5abf24ec76f0000110120a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be407f030100000b0008000000000000005d0004010100050201010100f140186a6bd413a50814db484b00398c2e7e6da9fbe2cb536728e880deb7506010027767f75fded47f94a6f81c671d448beddb6c2727f1f209ba015bf8de7331c13c100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100002b002800000000002102eebd2f91818a234e1879f8a55652f1e52419ad168b8f27b91be6b79958f7a5510000030101002b00280100020000210214a91dfcb36718209a5ee79c290029b849f1ce2feef6585a3b3fa37d04fb62b7000010030102001e001b0200030200144ee490084160fc8b1e73361d5a4c055beee77d8c0000110120e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4337f030100000b0008000000000000004f0004010100050201010100eb90b3c6d9a547e3b8a1111f621e0dbe5bfc68a8196371d497cb2912fa809d001002ab80ce7b6ca4875dbc7dc1f0d902551628c97b2383c27d04538d46a97d3cad43100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100001e001b0000020300149a061f31734c5f5f0b119ab72d433c9af133d3a60000030101003a003701000101003096e1fc631934a14acd313ff28ca29c9e9b43181b8df29386702b1a2d65a7cc823683f5733e296fb40c73648bc9cbf625000010030102001e001b02000102001474f185aa527f31202442d208cdb2905fa71403290000110201609f06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3000b03fda4d93a40301700000095840c6be056ed3d199dedf5265a5d3dafd195aa4cb54ca26943f7e092a5f06904200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000b03fd62132d410718000000b9dec92595e5eabb6de045782827bd98b60b9252287eec0f8e3450ea7c59619b1004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000b03fd8e29761d5405000000380d1a8cb3511b3ecf770a1d81f40c293182d29cf0574962db50c4cfb626fdb711042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30000b03fd62b9bfe135190000002eefa752386580c31084b54f2119973ccef6ac92fc38607e8609e896c9994c3e100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80000b03fdd0a1b7eee2140000002271b648a8925b8c717543453a59a3a20a3c52ce9b3e5fc793983c64f9f6fea004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2000b03fd1cb12a5b261400000068f31829eaec02f7e5eddada129d4981a99bda0e5c0fd4eff3c23eafc2c79a021004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e51000b03fd586ba25d1f1a0000005e3b38a6d9bede250ed0b612d01915a78182ee18d819d07d43ae925728b42d2d11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000b03fd120b51f4ea10000000be380b13cfd7149332e5ac818ae84d31e4be119bc0ebd717475630f6f38b6e90100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40000b03fd505d6c926f0d0000009500204c698cc12fc96774a34f77415c37376ff17b492838e414d774b5b7bec10420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae433000b03fd1e078984690800000064d995f4b5b62c480a04f1b8fb4c7a30b607f12da4abc357993ee7505be19b26111111";
    char *pub_key_hash_one_hex = "1f0815269afc012de44260ceb28a4496d3184184";
    char *pub_key_hash_two_hex = "4463a1a994d5040e69c090b6985d7af295bfd11a";
    char *pub_key_hash_three_hex = "5e0e49d808ad21d01d07dd799a75bd1b472788a7";

    unsigned char *multiple_identity_proof_bin = hex2bin(multiple_identity_proof_hex);
    unsigned char *pub_key_hashes[3] = {
            hex2bin(pub_key_hash_one_hex),
            hex2bin(pub_key_hash_two_hex),
            hex2bin(pub_key_hash_three_hex),
    };
    MultipleIdentityVerificationResult *multi_iden_result = verify_full_identities_by_public_key_hashes(multiple_identity_proof_bin, 6206, pub_key_hashes, 3);
    assert(multi_iden_result->is_valid);

    uint8_t expected_root_hash[32] = {202, 84, 121, 98, 165, 168, 181, 237, 228, 130, 249, 5, 45, 10, 35, 77, 17, 60, 42, 121, 141, 6, 90, 21, 12, 231, 68, 33, 156, 219, 114, 132};
    assert(is_array_equal(expected_root_hash, *multi_iden_result->root_hash, 32));

    assert(multi_iden_result->map_size == 3);

    uint8_t iden_one_pk_hash[20] = {  31,
                                      8,
                                      21,
                                      38,
                                      154,
                                      252,
                                      1,
                                      45,
                                      228,
                                      66,
                                      96,
                                      206,
                                      178,
                                      138,
                                      68,
                                      150,
                                      211,
                                      24,
                                      65,
                                      132};
    assert(is_array_equal(iden_one_pk_hash, multi_iden_result-> public_key_hash_identity_map[0]->public_key_hash, multi_iden_result->public_key_hash_identity_map[0]->public_key_hash_length));
    assert(multi_iden_result->public_key_hash_identity_map[0]->has_identity);

    uint8_t iden_two_pk_hash[20] = {   68,
                                       99,
                                       161,
                                       169,
                                       148,
                                       213,
                                       4,
                                       14,
                                       105,
                                       192,
                                       144,
                                       182,
                                       152,
                                       93,
                                       122,
                                       242,
                                       149,
                                       191,
                                       209,
                                       26};
    assert(is_array_equal(iden_two_pk_hash, multi_iden_result-> public_key_hash_identity_map[1]->public_key_hash, multi_iden_result->public_key_hash_identity_map[1]->public_key_hash_length));
    assert(multi_iden_result->public_key_hash_identity_map[1]->has_identity);

    uint8_t iden_three_pk_hash[20] = {   94,
                                       14,
                                       73,
                                       216, 8,
                                       173,
                                       33,
                                       208,
                                       29,
                                       7,
                                       221,
                                       121,
                                       154,
                                       117,
                                       189,
                                       27,
                                       71,
                                       39,
                                       136,
                                       167};
    assert(is_array_equal(iden_three_pk_hash, multi_iden_result-> public_key_hash_identity_map[2]->public_key_hash, multi_iden_result->public_key_hash_identity_map[2]->public_key_hash_length));
    assert(multi_iden_result->public_key_hash_identity_map[2]->has_identity);
}

void test_verify_full_identity_by_identity_id() {
    char *proof_hex = "06000100a603014a75cf3f535e81c4680f8137a2208dbcb2652ffd7e715bd4290cc5c560b2cc6102cfbe0535bd2defe586b863b9ccb92d0d66fb2b810d730e7ba2cb7e2fb302613b100401180018020114aee302720896bba837dcf3f2d674f546fd25496f00ca359aa1b2032e3158ae5e5c489f7d46722f29644a15e1cf7c3935b30606def61104012000240201203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200a0d5a4f6418663468515cd75189be3e1034bbfa9a1807eb81d964ba7442a0b1e100169931838564707dbf11e90a059fd7dd453cc7e68adb7d2c2375bae53566664e711025670752cc3d883200a7598b65cd74b41a760cc0be57cda5536f15f03c8783aa81001c33635136e502e9ac5244b15a20a757e0759ce0a90823cd37f893f6a49556d26040160002d0401203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2fd1cb12a5b2614000000fbbd3be097e7f07d5619dd69e7767884d116f95ae9a5fcdb651e71727902cc1e10011e0c1443d0925f781132f4c506747202dbffa3ca3ded4d2387d4b7e40e0303e311110201187f03144463a1a994d5040e69c090b6985d7af295bfd11a002300203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200029e6f2d33b1580030e3b6030e3c25016ab7253965682556059dcc243b75c7fa6d1001e09f88cd09cc595d524892b3e642b939f2827995605703c49c861f653001d5e1110101204d04203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200090201010201030000007fae89b888b23f4fbdaed2fb990a1f42727aef5bd2a8b91f8cb970570909ab3901203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a27f030100000b000800000000000000100004010100050201010100d651221796b5206a5b9678a4d9995d519d8b9e75e87d85e57effb91f82a23e8d1002bcf84a882c0f72dd0d520a6954b3e1887fa55b7dc67635b44516856b31fd20a8100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100001e001b0000010200144463a1a994d5040e69c090b6985d7af295bfd11a0000030101003a0037010002010030973988b291fd1bca86d906723e335bdf13d3ebbadfea31dd164b3c672c16da72af8e6edfc0bac44b92b8c536d708dc33000010030102002b00280200030000210360da79c58995e4ec88512af9a4440ca4f2d7bfe84240e17effc4dd8ce94033a20000110201604f04203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2000b03fd1cb12a5b261400000068f31829eaec02f7e5eddada129d4981a99bda0e5c0fd4eff3c23eafc2c79a02";
    char *identity_id_hex = "3eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2";

    unsigned char *proof_bin = hex2bin(proof_hex);
    unsigned char *identity_id_bin = hex2bin(identity_id_hex);

    IdentityVerificationResult *result = verify_full_identity_by_identity_id(proof_bin, 1038, true, identity_id_bin);
    assert(result->is_valid);

    uint8_t expected_root_hash[32] = {72,72,215,200,156,21,128,156,166,182,110,57,113,232,229,242,193,199,240,135,222,102,246,165,181,68,81,221,120,195,236,199};
    assert(is_array_equal(result->root_hash, expected_root_hash,32));

    assert(result->has_identity);
}

void test_verify_identity_id_by_public_key_hash() {
    char *multiple_identity_proof_hex = "06000100a603014a75cf3f535e81c4680f8137a2208dbcb2652ffd7e715bd4290cc5c560b2cc6102cfbe0535bd2defe586b863b9ccb92d0d66fb2b810d730e7ba2cb7e2fb302613b1004011800180201145e0e49d808ad21d01d07dd799a75bd1b472788a7008c10aa4c1d19e2e7e42fe0b1a7f6d93d4c0b6992ef63ea985c16447cada4629511040120002402012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000ba56cfb1d87ef47857f6b1cd7fb918406fd50f81966619777dd4c1b595a1a26e100169931838564707dbf11e90a059fd7dd453cc7e68adb7d2c2375bae53566664e711025670752cc3d883200a7598b65cd74b41a760cc0be57cda5536f15f03c8783aa81001c33635136e502e9ac5244b15a20a757e0759ce0a90823cd37f893f6a49556d26040160002d04012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30fdbafd6833aeb700000012b27f4a0a7cfd06e3387b33a5bca6682953512e21621ae9cf6d633d9041771910011e0c1443d0925f781132f4c506747202dbffa3ca3ded4d2387d4b7e40e0303e31111020118b3080132c9d35844d5ce2a8e0f377cee23c143a53396073dea86c494b86ba4c4af0b3903141f0815269afc012de44260ceb28a4496d3184184002300200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb00100168576e24521e03ba4b624912bb07833767c81102310b87d8ea1caf2795c68f921102e8b7eb376f0f7993badf93971f690be8a48f09db0711f052a2ed48471497b9d01003144463a1a994d5040e69c090b6985d7af295bfd11a002300203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a20002254bf0a990beb721c21f21e8dbab50e33cd9cf09618fc27c9f7450c673516aee1001c6adfe081809218ee07461f95f53ce6ce462ec379f97a71f1be40f7218cb50af111103145e0e49d808ad21d01d07dd799a75bd1b472788a70023002035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30001001a4b31998d47c30e390f4fa56f28f19c62f114f17a704d29c56e28b6fdb47f101031467892af390cd2b7653a918c7b692c85b87b44d3200230020399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80001001eb4da977338a3da4204eaaac0c8856bdfd51d9b25ceef04b40bb38eff79ab11011021f22102429dbe1bc0ca714847b08187d9a874cc43329aaa79647fb9aa0834d691003149a061f31734c5f5f0b119ab72d433c9af133d3a600230020e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330002644c601e67692188cf5a975c2207caba899d99f1bbd4b62e5fe856850b9d7286100314a54921bb29b67e31898efebc29f241b1aefa4dca002300207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e510010029e6f2d33b1580030e3b6030e3c25016ab7253965682556059dcc243b75c7fa6d0314b3bfce478de96fe30cd3713bf88ce7728687da8a00230020a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40001111110314bb3df025e32fd90d1feee7dca4b83321c683292d0023002003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3001001ee0847805b145b5fb500b139fe12767ee681fc310a21d6e9814619df5187470802a0de352fe6767da7bf4c33ba7d2da8db0440457835d3c2992473210e02b6312c1001e09f88cd09cc595d524892b3e642b939f2827995605703c49c861f653001d5e1029a563c983d202520c1a94f4c6ba99750373450aaf9dcb2a62ef50e9877646043100314ed738aaadd75d1677fefeccadd033f126cfee76a0023002097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000314fbd9daa5993de56a2e4346b7c72ff5585efffaab002300201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb0010111111110101208b06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d300090201010201030000006c4bfcf223cd4fe5c1cac82e1a9e2c73eb0e7f34cebabdd7630e24cb192f975804200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000902010102010300000080da62acb8c49f901d6bf84a2a2af15431e69e29069abf8d02f2c113c6099ba61004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000902010102010300000051a23049efbcde3a0e9c85ea7af05a28d4de31f90ae44a07c5fa18090128237011042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000090201010201030000002a390761b997897afe51540c39dfeb5c78d00781a547d2b83b1e72259894dea5100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f800009020101020103000000b3f28f9cc26df90ea49e13e3cd97c01d772e9d6609453e91d4369ef78e3880a004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200090201010201030000007fae89b888b23f4fbdaed2fb990a1f42727aef5bd2a8b91f8cb970570909ab391004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e5100090201010201030000001d64a3f9270bf8b8104305ba76829472f3aac2b6fff20b98ac10361ec5473fbb11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef0009020101020103000000adb76570d64f89650686df5819414e5e42cf7eedab24605aa63c4b8e26e90eda100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be400009020101020103000000a5a8530416d9462521b6fd932723d8971684b4620e4254caf09c75289e0e64700420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330009020101020103000000fa1d907f967c48292a5af3d4c3aad435c2ee9237119614d612aee3b4f52e3614111111012003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d37f030100000b0008000000000000003d000401010005020101010072cc451270c61384d358f7d41135b78788011830301a697b97a3714c203a36dc100214105bdf191491b67249d321f3d9bebdf82c9a3395fef336c60b3701af0593e7100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b000002030014bb3df025e32fd90d1feee7dca4b83321c683292d0000030101003a0037010001010030a5fd02c96d5f60eb54b15b043a84ed80a0af804eff4a2bfea1fc9fed323232c7ab12072368097e556439d08aa0a6866c000010030102003a003702000001003085ff00e6339367d3e31e27cbc33c13c3cd0c6e973a5b902e76668d7a6daf83c129257cc7f9cc35e1c0689a6df03a891d00001101200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb7f030100000b000800000000000000030004010100050201010100783a62676dbffd012f9343ef0af71c1b800cda19801689dfb7e2372cccc3ed9d10027f0e94e54c63ffdcd3d3d9017a63e82f9984ade5c4faa59d2479c11007932524100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df1102010178030100002b002800000200002103fe65fcdcfe242dc2e43d654274ec9ce1bbbc9dd5a1c88945eeef18cc93151f7f0000030101001e001b010001030014c94f46cf38b83862990f782c84acbc178d7b02da000010030102001e001b02000203001426d387d9884862f96160dd59ca596bdce82da74600001101201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb7f030100000b000800000000000000600004010100050201010100ca3a10eab3b889465bba51bc5354131aee1044e510d9ed4a7068d1181c7dbfcd10029626ec2b4e8861c675b20bc4456333d8c41fd0c0b9c9f0b78047c6634ebab8ef100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100001e001b000003020014fbd9daa5993de56a2e4346b7c72ff5585efffaab0000030101002b002801000300002103fdc9403eb6f005db700e7841627f4f92e7c65d167384cd57a4f4e46583c21afe000010030102002b002802000000002103703446f77c8db1fbac6f3422c8e045098adb662c0b620a15b8c4d9ecd2a3defa000011012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c307f030100000b000800000000000000420004010100050201010100d7f397a816f23f32e9a6cd2ab5b03d5b6d30742cf0b58517f276d9f75c1c4d611002bfd5686ae0d2a7684c2f6ed3a7419a436a5389afc9a84a1bb22a1decdfa7625d100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b0000020300145e0e49d808ad21d01d07dd799a75bd1b472788a70000030101003a003701000001003097c8d8102d216818c693dc46614ce9242b8e54e05a8ff1f520a3694b9481091d92906b13b9b2762b127ee4f07e91119e000010030102003a00370200030100308949c96dda849268044e176dbdba458fb5deac81e9918793bdb837f5afee0c2496a5930d46d1fe37ce536cbef8e95bb40000110120399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f807f030100000b0008000000000000000c0004010100050201010100a9403aa408af35d267980dfff1706d70a59b6dba867d0b568ca8c5b77560d67a100276cbfe822d7b9f6863f9a06b668097458e123ff385e31c29d830d03f1148973a100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100003a0037000000010030b79d4caa865f84207124c3d304430372f39d7c18a237df3a71e3c4fb7ba9ab9816439a809beb8606c3bb52d53a5364590000030101001e001b0100030200146406a5082b231340726d4cd0de2452bc73a33003000010030102001e001b0200010300144ac7b42f524e1d1b22098f85adfca752600ef9a000001101203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a27f030100000b000800000000000000100004010100050201010100d651221796b5206a5b9678a4d9995d519d8b9e75e87d85e57effb91f82a23e8d1002bcf84a882c0f72dd0d520a6954b3e1887fa55b7dc67635b44516856b31fd20a8100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100001e001b0000010200144463a1a994d5040e69c090b6985d7af295bfd11a0000030101003a0037010002010030973988b291fd1bca86d906723e335bdf13d3ebbadfea31dd164b3c672c16da72af8e6edfc0bac44b92b8c536d708dc33000010030102002b00280200030000210360da79c58995e4ec88512af9a4440ca4f2d7bfe84240e17effc4dd8ce94033a200001101207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e517f030100000b000800000000000000580004010100050201010100d95ff983db933edc675487a6f4e388fcf2db59313aeab5f45991a7f2471774471002355f98c38fd87ca5775e5e451243eb11300ed91fc950ea204c0a74b9a1991a25100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100003a0037000003010030b3423844bae8a591bbfb437b55566b5d61e54ee64f93351b0a3b9d4b731445d25ce367f7aedfcb32bd3cd14308a54cf50000030101003a0037010001010030a154c19082ac6b5fec72b81f6488550fec7149d52f66b4463915a61179c4f1f8507d366614b454dabf2c942235caad01000010030102001e001b0200030300140a8c14745c982f9fdc43aa985c02b1e5bff6c403000011012097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef7f030100000b000800000000000000620004010100050201010100412c1e7de2394dcd009223eb8c3a24e34b93a7c48df0bb86499160a31ea9dbdb1002180590eec33397034675f379cf17f62c0e77d17724a03238dcd3f216a4bc9509100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100003a0037000002010030afa4370aa5a48ab2f3ab510ccaba3b6d8cf51752304507e6a341c4e4ff6aa7c07610a503b42f479834b032d25dd160590000030101002b002801000300002103a9584c4580d165d2744ba49a70472653915bfdbec4bef471e26ce4c1c9e6c6ab000010030102001e001b02000102001445d04558a26b8ca04b486957c8abf5abf24ec76f0000110120a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be407f030100000b0008000000000000005d0004010100050201010100f140186a6bd413a50814db484b00398c2e7e6da9fbe2cb536728e880deb7506010027767f75fded47f94a6f81c671d448beddb6c2727f1f209ba015bf8de7331c13c100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100002b002800000000002102eebd2f91818a234e1879f8a55652f1e52419ad168b8f27b91be6b79958f7a5510000030101002b00280100020000210214a91dfcb36718209a5ee79c290029b849f1ce2feef6585a3b3fa37d04fb62b7000010030102001e001b0200030200144ee490084160fc8b1e73361d5a4c055beee77d8c0000110120e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4337f030100000b0008000000000000004f0004010100050201010100eb90b3c6d9a547e3b8a1111f621e0dbe5bfc68a8196371d497cb2912fa809d001002ab80ce7b6ca4875dbc7dc1f0d902551628c97b2383c27d04538d46a97d3cad43100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100001e001b0000020300149a061f31734c5f5f0b119ab72d433c9af133d3a60000030101003a003701000101003096e1fc631934a14acd313ff28ca29c9e9b43181b8df29386702b1a2d65a7cc823683f5733e296fb40c73648bc9cbf625000010030102001e001b02000102001474f185aa527f31202442d208cdb2905fa71403290000110201609f06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3000b03fda4d93a40301700000095840c6be056ed3d199dedf5265a5d3dafd195aa4cb54ca26943f7e092a5f06904200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000b03fd62132d410718000000b9dec92595e5eabb6de045782827bd98b60b9252287eec0f8e3450ea7c59619b1004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000b03fd8e29761d5405000000380d1a8cb3511b3ecf770a1d81f40c293182d29cf0574962db50c4cfb626fdb711042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30000b03fd62b9bfe135190000002eefa752386580c31084b54f2119973ccef6ac92fc38607e8609e896c9994c3e100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80000b03fdd0a1b7eee2140000002271b648a8925b8c717543453a59a3a20a3c52ce9b3e5fc793983c64f9f6fea004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2000b03fd1cb12a5b261400000068f31829eaec02f7e5eddada129d4981a99bda0e5c0fd4eff3c23eafc2c79a021004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e51000b03fd586ba25d1f1a0000005e3b38a6d9bede250ed0b612d01915a78182ee18d819d07d43ae925728b42d2d11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000b03fd120b51f4ea10000000be380b13cfd7149332e5ac818ae84d31e4be119bc0ebd717475630f6f38b6e90100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40000b03fd505d6c926f0d0000009500204c698cc12fc96774a34f77415c37376ff17b492838e414d774b5b7bec10420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae433000b03fd1e078984690800000064d995f4b5b62c480a04f1b8fb4c7a30b607f12da4abc357993ee7505be19b26111111";
    char *pub_key_hash_hex = "1f0815269afc012de44260ceb28a4496d3184184";

    unsigned char *proof = hex2bin(multiple_identity_proof_hex);
    unsigned char *pub_key_hash = hex2bin(pub_key_hash_hex);

    IdentityIdVerificationResult *result = verify_identity_id_by_public_key_hash(proof, 6206, true, pub_key_hash);
    uint8_t expected_identity_id[32] = {15, 126, 159, 152, 150, 254, 206, 186, 180, 193, 157, 65, 233, 215, 241, 108, 23, 39,
                                    205, 99, 217, 219, 86, 244, 213, 176, 67, 34, 242, 146, 86, 203,};
    assert(result->is_valid);
    assert(result->has_identity_id);
    assert(result->id_size == 32);
    assert(is_array_equal(expected_identity_id, result->identity_id, result->id_size));
}

void test_verify_identity_balances_by_identity_ids() {
    char *multiple_identity_proof_hex = "06000100a603014a75cf3f535e81c4680f8137a2208dbcb2652ffd7e715bd4290cc5c560b2cc6102cfbe0535bd2defe586b863b9ccb92d0d66fb2b810d730e7ba2cb7e2fb302613b1004011800180201145e0e49d808ad21d01d07dd799a75bd1b472788a7008c10aa4c1d19e2e7e42fe0b1a7f6d93d4c0b6992ef63ea985c16447cada4629511040120002402012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000ba56cfb1d87ef47857f6b1cd7fb918406fd50f81966619777dd4c1b595a1a26e100169931838564707dbf11e90a059fd7dd453cc7e68adb7d2c2375bae53566664e711025670752cc3d883200a7598b65cd74b41a760cc0be57cda5536f15f03c8783aa81001c33635136e502e9ac5244b15a20a757e0759ce0a90823cd37f893f6a49556d26040160002d04012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30fdbafd6833aeb700000012b27f4a0a7cfd06e3387b33a5bca6682953512e21621ae9cf6d633d9041771910011e0c1443d0925f781132f4c506747202dbffa3ca3ded4d2387d4b7e40e0303e31111020118b3080132c9d35844d5ce2a8e0f377cee23c143a53396073dea86c494b86ba4c4af0b3903141f0815269afc012de44260ceb28a4496d3184184002300200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb00100168576e24521e03ba4b624912bb07833767c81102310b87d8ea1caf2795c68f921102e8b7eb376f0f7993badf93971f690be8a48f09db0711f052a2ed48471497b9d01003144463a1a994d5040e69c090b6985d7af295bfd11a002300203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a20002254bf0a990beb721c21f21e8dbab50e33cd9cf09618fc27c9f7450c673516aee1001c6adfe081809218ee07461f95f53ce6ce462ec379f97a71f1be40f7218cb50af111103145e0e49d808ad21d01d07dd799a75bd1b472788a70023002035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30001001a4b31998d47c30e390f4fa56f28f19c62f114f17a704d29c56e28b6fdb47f101031467892af390cd2b7653a918c7b692c85b87b44d3200230020399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80001001eb4da977338a3da4204eaaac0c8856bdfd51d9b25ceef04b40bb38eff79ab11011021f22102429dbe1bc0ca714847b08187d9a874cc43329aaa79647fb9aa0834d691003149a061f31734c5f5f0b119ab72d433c9af133d3a600230020e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330002644c601e67692188cf5a975c2207caba899d99f1bbd4b62e5fe856850b9d7286100314a54921bb29b67e31898efebc29f241b1aefa4dca002300207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e510010029e6f2d33b1580030e3b6030e3c25016ab7253965682556059dcc243b75c7fa6d0314b3bfce478de96fe30cd3713bf88ce7728687da8a00230020a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40001111110314bb3df025e32fd90d1feee7dca4b83321c683292d0023002003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3001001ee0847805b145b5fb500b139fe12767ee681fc310a21d6e9814619df5187470802a0de352fe6767da7bf4c33ba7d2da8db0440457835d3c2992473210e02b6312c1001e09f88cd09cc595d524892b3e642b939f2827995605703c49c861f653001d5e1029a563c983d202520c1a94f4c6ba99750373450aaf9dcb2a62ef50e9877646043100314ed738aaadd75d1677fefeccadd033f126cfee76a0023002097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000314fbd9daa5993de56a2e4346b7c72ff5585efffaab002300201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb0010111111110101208b06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d300090201010201030000006c4bfcf223cd4fe5c1cac82e1a9e2c73eb0e7f34cebabdd7630e24cb192f975804200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000902010102010300000080da62acb8c49f901d6bf84a2a2af15431e69e29069abf8d02f2c113c6099ba61004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000902010102010300000051a23049efbcde3a0e9c85ea7af05a28d4de31f90ae44a07c5fa18090128237011042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000090201010201030000002a390761b997897afe51540c39dfeb5c78d00781a547d2b83b1e72259894dea5100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f800009020101020103000000b3f28f9cc26df90ea49e13e3cd97c01d772e9d6609453e91d4369ef78e3880a004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200090201010201030000007fae89b888b23f4fbdaed2fb990a1f42727aef5bd2a8b91f8cb970570909ab391004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e5100090201010201030000001d64a3f9270bf8b8104305ba76829472f3aac2b6fff20b98ac10361ec5473fbb11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef0009020101020103000000adb76570d64f89650686df5819414e5e42cf7eedab24605aa63c4b8e26e90eda100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be400009020101020103000000a5a8530416d9462521b6fd932723d8971684b4620e4254caf09c75289e0e64700420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330009020101020103000000fa1d907f967c48292a5af3d4c3aad435c2ee9237119614d612aee3b4f52e3614111111012003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d37f030100000b0008000000000000003d000401010005020101010072cc451270c61384d358f7d41135b78788011830301a697b97a3714c203a36dc100214105bdf191491b67249d321f3d9bebdf82c9a3395fef336c60b3701af0593e7100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b000002030014bb3df025e32fd90d1feee7dca4b83321c683292d0000030101003a0037010001010030a5fd02c96d5f60eb54b15b043a84ed80a0af804eff4a2bfea1fc9fed323232c7ab12072368097e556439d08aa0a6866c000010030102003a003702000001003085ff00e6339367d3e31e27cbc33c13c3cd0c6e973a5b902e76668d7a6daf83c129257cc7f9cc35e1c0689a6df03a891d00001101200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb7f030100000b000800000000000000030004010100050201010100783a62676dbffd012f9343ef0af71c1b800cda19801689dfb7e2372cccc3ed9d10027f0e94e54c63ffdcd3d3d9017a63e82f9984ade5c4faa59d2479c11007932524100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df1102010178030100002b002800000200002103fe65fcdcfe242dc2e43d654274ec9ce1bbbc9dd5a1c88945eeef18cc93151f7f0000030101001e001b010001030014c94f46cf38b83862990f782c84acbc178d7b02da000010030102001e001b02000203001426d387d9884862f96160dd59ca596bdce82da74600001101201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb7f030100000b000800000000000000600004010100050201010100ca3a10eab3b889465bba51bc5354131aee1044e510d9ed4a7068d1181c7dbfcd10029626ec2b4e8861c675b20bc4456333d8c41fd0c0b9c9f0b78047c6634ebab8ef100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100001e001b000003020014fbd9daa5993de56a2e4346b7c72ff5585efffaab0000030101002b002801000300002103fdc9403eb6f005db700e7841627f4f92e7c65d167384cd57a4f4e46583c21afe000010030102002b002802000000002103703446f77c8db1fbac6f3422c8e045098adb662c0b620a15b8c4d9ecd2a3defa000011012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c307f030100000b000800000000000000420004010100050201010100d7f397a816f23f32e9a6cd2ab5b03d5b6d30742cf0b58517f276d9f75c1c4d611002bfd5686ae0d2a7684c2f6ed3a7419a436a5389afc9a84a1bb22a1decdfa7625d100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b0000020300145e0e49d808ad21d01d07dd799a75bd1b472788a70000030101003a003701000001003097c8d8102d216818c693dc46614ce9242b8e54e05a8ff1f520a3694b9481091d92906b13b9b2762b127ee4f07e91119e000010030102003a00370200030100308949c96dda849268044e176dbdba458fb5deac81e9918793bdb837f5afee0c2496a5930d46d1fe37ce536cbef8e95bb40000110120399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f807f030100000b0008000000000000000c0004010100050201010100a9403aa408af35d267980dfff1706d70a59b6dba867d0b568ca8c5b77560d67a100276cbfe822d7b9f6863f9a06b668097458e123ff385e31c29d830d03f1148973a100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100003a0037000000010030b79d4caa865f84207124c3d304430372f39d7c18a237df3a71e3c4fb7ba9ab9816439a809beb8606c3bb52d53a5364590000030101001e001b0100030200146406a5082b231340726d4cd0de2452bc73a33003000010030102001e001b0200010300144ac7b42f524e1d1b22098f85adfca752600ef9a000001101203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a27f030100000b000800000000000000100004010100050201010100d651221796b5206a5b9678a4d9995d519d8b9e75e87d85e57effb91f82a23e8d1002bcf84a882c0f72dd0d520a6954b3e1887fa55b7dc67635b44516856b31fd20a8100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100001e001b0000010200144463a1a994d5040e69c090b6985d7af295bfd11a0000030101003a0037010002010030973988b291fd1bca86d906723e335bdf13d3ebbadfea31dd164b3c672c16da72af8e6edfc0bac44b92b8c536d708dc33000010030102002b00280200030000210360da79c58995e4ec88512af9a4440ca4f2d7bfe84240e17effc4dd8ce94033a200001101207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e517f030100000b000800000000000000580004010100050201010100d95ff983db933edc675487a6f4e388fcf2db59313aeab5f45991a7f2471774471002355f98c38fd87ca5775e5e451243eb11300ed91fc950ea204c0a74b9a1991a25100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100003a0037000003010030b3423844bae8a591bbfb437b55566b5d61e54ee64f93351b0a3b9d4b731445d25ce367f7aedfcb32bd3cd14308a54cf50000030101003a0037010001010030a154c19082ac6b5fec72b81f6488550fec7149d52f66b4463915a61179c4f1f8507d366614b454dabf2c942235caad01000010030102001e001b0200030300140a8c14745c982f9fdc43aa985c02b1e5bff6c403000011012097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef7f030100000b000800000000000000620004010100050201010100412c1e7de2394dcd009223eb8c3a24e34b93a7c48df0bb86499160a31ea9dbdb1002180590eec33397034675f379cf17f62c0e77d17724a03238dcd3f216a4bc9509100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100003a0037000002010030afa4370aa5a48ab2f3ab510ccaba3b6d8cf51752304507e6a341c4e4ff6aa7c07610a503b42f479834b032d25dd160590000030101002b002801000300002103a9584c4580d165d2744ba49a70472653915bfdbec4bef471e26ce4c1c9e6c6ab000010030102001e001b02000102001445d04558a26b8ca04b486957c8abf5abf24ec76f0000110120a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be407f030100000b0008000000000000005d0004010100050201010100f140186a6bd413a50814db484b00398c2e7e6da9fbe2cb536728e880deb7506010027767f75fded47f94a6f81c671d448beddb6c2727f1f209ba015bf8de7331c13c100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100002b002800000000002102eebd2f91818a234e1879f8a55652f1e52419ad168b8f27b91be6b79958f7a5510000030101002b00280100020000210214a91dfcb36718209a5ee79c290029b849f1ce2feef6585a3b3fa37d04fb62b7000010030102001e001b0200030200144ee490084160fc8b1e73361d5a4c055beee77d8c0000110120e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4337f030100000b0008000000000000004f0004010100050201010100eb90b3c6d9a547e3b8a1111f621e0dbe5bfc68a8196371d497cb2912fa809d001002ab80ce7b6ca4875dbc7dc1f0d902551628c97b2383c27d04538d46a97d3cad43100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100001e001b0000020300149a061f31734c5f5f0b119ab72d433c9af133d3a60000030101003a003701000101003096e1fc631934a14acd313ff28ca29c9e9b43181b8df29386702b1a2d65a7cc823683f5733e296fb40c73648bc9cbf625000010030102001e001b02000102001474f185aa527f31202442d208cdb2905fa71403290000110201609f06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3000b03fda4d93a40301700000095840c6be056ed3d199dedf5265a5d3dafd195aa4cb54ca26943f7e092a5f06904200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000b03fd62132d410718000000b9dec92595e5eabb6de045782827bd98b60b9252287eec0f8e3450ea7c59619b1004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000b03fd8e29761d5405000000380d1a8cb3511b3ecf770a1d81f40c293182d29cf0574962db50c4cfb626fdb711042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30000b03fd62b9bfe135190000002eefa752386580c31084b54f2119973ccef6ac92fc38607e8609e896c9994c3e100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80000b03fdd0a1b7eee2140000002271b648a8925b8c717543453a59a3a20a3c52ce9b3e5fc793983c64f9f6fea004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2000b03fd1cb12a5b261400000068f31829eaec02f7e5eddada129d4981a99bda0e5c0fd4eff3c23eafc2c79a021004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e51000b03fd586ba25d1f1a0000005e3b38a6d9bede250ed0b612d01915a78182ee18d819d07d43ae925728b42d2d11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000b03fd120b51f4ea10000000be380b13cfd7149332e5ac818ae84d31e4be119bc0ebd717475630f6f38b6e90100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40000b03fd505d6c926f0d0000009500204c698cc12fc96774a34f77415c37376ff17b492838e414d774b5b7bec10420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae433000b03fd1e078984690800000064d995f4b5b62c480a04f1b8fb4c7a30b607f12da4abc357993ee7505be19b26111111";
    char *iden_one_hex = "3eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2";
    char *iden_two_hex = "97ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef";

    unsigned char *proof = hex2bin(multiple_identity_proof_hex);
    unsigned char *iden_ids[2] = {
            hex2bin(iden_one_hex),
            hex2bin(iden_two_hex),
    };
    MultipleIdentityBalanceVerificationResult *result = verify_identity_balances_by_identity_ids(proof, 6206, true, iden_ids, 2);
    assert(result->is_valid);
    assert(result->map_size == 2);
    assert(result->identity_id_balance_map[0]->has_balance);
    assert(result->identity_id_balance_map[0]->balance == 11077485418638);
    uint8_t expected_iden_one_bin[32] = {62, 171, 130, 51, 233, 19, 45, 191, 194, 183, 0, 171, 182, 77, 93, 70, 216, 67, 22,
                                         47, 39, 25, 156, 146, 35, 108, 99, 133, 34, 187, 243, 162};
    assert(is_array_equal(expected_iden_one_bin, result->identity_id_balance_map[0]->identity_id, result->identity_id_balance_map[0]->id_size));

    assert(result->identity_id_balance_map[1]->has_balance);
    assert(result->identity_id_balance_map[1]->balance == 9300653671817);
    uint8_t expected_iden_two_bin[32] = {151, 172, 124, 81, 243, 147, 225, 5, 188, 204, 9, 152, 150, 127, 129, 13, 246, 19,
                                         141, 93, 239, 8, 214, 194, 123, 127, 177, 23, 144, 211, 189, 239,};
    assert(is_array_equal(expected_iden_two_bin, result->identity_id_balance_map[1]->identity_id, result->identity_id_balance_map[1]->id_size));
}

void test_verify_identity_ids_by_public_key_hashes() {
    char *multiple_identity_proof_hex = "06000100a603014a75cf3f535e81c4680f8137a2208dbcb2652ffd7e715bd4290cc5c560b2cc6102cfbe0535bd2defe586b863b9ccb92d0d66fb2b810d730e7ba2cb7e2fb302613b1004011800180201145e0e49d808ad21d01d07dd799a75bd1b472788a7008c10aa4c1d19e2e7e42fe0b1a7f6d93d4c0b6992ef63ea985c16447cada4629511040120002402012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000ba56cfb1d87ef47857f6b1cd7fb918406fd50f81966619777dd4c1b595a1a26e100169931838564707dbf11e90a059fd7dd453cc7e68adb7d2c2375bae53566664e711025670752cc3d883200a7598b65cd74b41a760cc0be57cda5536f15f03c8783aa81001c33635136e502e9ac5244b15a20a757e0759ce0a90823cd37f893f6a49556d26040160002d04012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30fdbafd6833aeb700000012b27f4a0a7cfd06e3387b33a5bca6682953512e21621ae9cf6d633d9041771910011e0c1443d0925f781132f4c506747202dbffa3ca3ded4d2387d4b7e40e0303e31111020118b3080132c9d35844d5ce2a8e0f377cee23c143a53396073dea86c494b86ba4c4af0b3903141f0815269afc012de44260ceb28a4496d3184184002300200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb00100168576e24521e03ba4b624912bb07833767c81102310b87d8ea1caf2795c68f921102e8b7eb376f0f7993badf93971f690be8a48f09db0711f052a2ed48471497b9d01003144463a1a994d5040e69c090b6985d7af295bfd11a002300203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a20002254bf0a990beb721c21f21e8dbab50e33cd9cf09618fc27c9f7450c673516aee1001c6adfe081809218ee07461f95f53ce6ce462ec379f97a71f1be40f7218cb50af111103145e0e49d808ad21d01d07dd799a75bd1b472788a70023002035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30001001a4b31998d47c30e390f4fa56f28f19c62f114f17a704d29c56e28b6fdb47f101031467892af390cd2b7653a918c7b692c85b87b44d3200230020399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80001001eb4da977338a3da4204eaaac0c8856bdfd51d9b25ceef04b40bb38eff79ab11011021f22102429dbe1bc0ca714847b08187d9a874cc43329aaa79647fb9aa0834d691003149a061f31734c5f5f0b119ab72d433c9af133d3a600230020e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330002644c601e67692188cf5a975c2207caba899d99f1bbd4b62e5fe856850b9d7286100314a54921bb29b67e31898efebc29f241b1aefa4dca002300207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e510010029e6f2d33b1580030e3b6030e3c25016ab7253965682556059dcc243b75c7fa6d0314b3bfce478de96fe30cd3713bf88ce7728687da8a00230020a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40001111110314bb3df025e32fd90d1feee7dca4b83321c683292d0023002003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3001001ee0847805b145b5fb500b139fe12767ee681fc310a21d6e9814619df5187470802a0de352fe6767da7bf4c33ba7d2da8db0440457835d3c2992473210e02b6312c1001e09f88cd09cc595d524892b3e642b939f2827995605703c49c861f653001d5e1029a563c983d202520c1a94f4c6ba99750373450aaf9dcb2a62ef50e9877646043100314ed738aaadd75d1677fefeccadd033f126cfee76a0023002097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000314fbd9daa5993de56a2e4346b7c72ff5585efffaab002300201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb0010111111110101208b06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d300090201010201030000006c4bfcf223cd4fe5c1cac82e1a9e2c73eb0e7f34cebabdd7630e24cb192f975804200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000902010102010300000080da62acb8c49f901d6bf84a2a2af15431e69e29069abf8d02f2c113c6099ba61004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000902010102010300000051a23049efbcde3a0e9c85ea7af05a28d4de31f90ae44a07c5fa18090128237011042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c3000090201010201030000002a390761b997897afe51540c39dfeb5c78d00781a547d2b83b1e72259894dea5100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f800009020101020103000000b3f28f9cc26df90ea49e13e3cd97c01d772e9d6609453e91d4369ef78e3880a004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a200090201010201030000007fae89b888b23f4fbdaed2fb990a1f42727aef5bd2a8b91f8cb970570909ab391004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e5100090201010201030000001d64a3f9270bf8b8104305ba76829472f3aac2b6fff20b98ac10361ec5473fbb11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef0009020101020103000000adb76570d64f89650686df5819414e5e42cf7eedab24605aa63c4b8e26e90eda100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be400009020101020103000000a5a8530416d9462521b6fd932723d8971684b4620e4254caf09c75289e0e64700420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4330009020101020103000000fa1d907f967c48292a5af3d4c3aad435c2ee9237119614d612aee3b4f52e3614111111012003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d37f030100000b0008000000000000003d000401010005020101010072cc451270c61384d358f7d41135b78788011830301a697b97a3714c203a36dc100214105bdf191491b67249d321f3d9bebdf82c9a3395fef336c60b3701af0593e7100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b000002030014bb3df025e32fd90d1feee7dca4b83321c683292d0000030101003a0037010001010030a5fd02c96d5f60eb54b15b043a84ed80a0af804eff4a2bfea1fc9fed323232c7ab12072368097e556439d08aa0a6866c000010030102003a003702000001003085ff00e6339367d3e31e27cbc33c13c3cd0c6e973a5b902e76668d7a6daf83c129257cc7f9cc35e1c0689a6df03a891d00001101200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb7f030100000b000800000000000000030004010100050201010100783a62676dbffd012f9343ef0af71c1b800cda19801689dfb7e2372cccc3ed9d10027f0e94e54c63ffdcd3d3d9017a63e82f9984ade5c4faa59d2479c11007932524100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df1102010178030100002b002800000200002103fe65fcdcfe242dc2e43d654274ec9ce1bbbc9dd5a1c88945eeef18cc93151f7f0000030101001e001b010001030014c94f46cf38b83862990f782c84acbc178d7b02da000010030102001e001b02000203001426d387d9884862f96160dd59ca596bdce82da74600001101201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb7f030100000b000800000000000000600004010100050201010100ca3a10eab3b889465bba51bc5354131aee1044e510d9ed4a7068d1181c7dbfcd10029626ec2b4e8861c675b20bc4456333d8c41fd0c0b9c9f0b78047c6634ebab8ef100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100001e001b000003020014fbd9daa5993de56a2e4346b7c72ff5585efffaab0000030101002b002801000300002103fdc9403eb6f005db700e7841627f4f92e7c65d167384cd57a4f4e46583c21afe000010030102002b002802000000002103703446f77c8db1fbac6f3422c8e045098adb662c0b620a15b8c4d9ecd2a3defa000011012035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c307f030100000b000800000000000000420004010100050201010100d7f397a816f23f32e9a6cd2ab5b03d5b6d30742cf0b58517f276d9f75c1c4d611002bfd5686ae0d2a7684c2f6ed3a7419a436a5389afc9a84a1bb22a1decdfa7625d100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100001e001b0000020300145e0e49d808ad21d01d07dd799a75bd1b472788a70000030101003a003701000001003097c8d8102d216818c693dc46614ce9242b8e54e05a8ff1f520a3694b9481091d92906b13b9b2762b127ee4f07e91119e000010030102003a00370200030100308949c96dda849268044e176dbdba458fb5deac81e9918793bdb837f5afee0c2496a5930d46d1fe37ce536cbef8e95bb40000110120399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f807f030100000b0008000000000000000c0004010100050201010100a9403aa408af35d267980dfff1706d70a59b6dba867d0b568ca8c5b77560d67a100276cbfe822d7b9f6863f9a06b668097458e123ff385e31c29d830d03f1148973a100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100003a0037000000010030b79d4caa865f84207124c3d304430372f39d7c18a237df3a71e3c4fb7ba9ab9816439a809beb8606c3bb52d53a5364590000030101001e001b0100030200146406a5082b231340726d4cd0de2452bc73a33003000010030102001e001b0200010300144ac7b42f524e1d1b22098f85adfca752600ef9a000001101203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a27f030100000b000800000000000000100004010100050201010100d651221796b5206a5b9678a4d9995d519d8b9e75e87d85e57effb91f82a23e8d1002bcf84a882c0f72dd0d520a6954b3e1887fa55b7dc67635b44516856b31fd20a8100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100001e001b0000010200144463a1a994d5040e69c090b6985d7af295bfd11a0000030101003a0037010002010030973988b291fd1bca86d906723e335bdf13d3ebbadfea31dd164b3c672c16da72af8e6edfc0bac44b92b8c536d708dc33000010030102002b00280200030000210360da79c58995e4ec88512af9a4440ca4f2d7bfe84240e17effc4dd8ce94033a200001101207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e517f030100000b000800000000000000580004010100050201010100d95ff983db933edc675487a6f4e388fcf2db59313aeab5f45991a7f2471774471002355f98c38fd87ca5775e5e451243eb11300ed91fc950ea204c0a74b9a1991a25100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df11020101a301030100003a0037000003010030b3423844bae8a591bbfb437b55566b5d61e54ee64f93351b0a3b9d4b731445d25ce367f7aedfcb32bd3cd14308a54cf50000030101003a0037010001010030a154c19082ac6b5fec72b81f6488550fec7149d52f66b4463915a61179c4f1f8507d366614b454dabf2c942235caad01000010030102001e001b0200030300140a8c14745c982f9fdc43aa985c02b1e5bff6c403000011012097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef7f030100000b000800000000000000620004010100050201010100412c1e7de2394dcd009223eb8c3a24e34b93a7c48df0bb86499160a31ea9dbdb1002180590eec33397034675f379cf17f62c0e77d17724a03238dcd3f216a4bc9509100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201019401030100003a0037000002010030afa4370aa5a48ab2f3ab510ccaba3b6d8cf51752304507e6a341c4e4ff6aa7c07610a503b42f479834b032d25dd160590000030101002b002801000300002103a9584c4580d165d2744ba49a70472653915bfdbec4bef471e26ce4c1c9e6c6ab000010030102001e001b02000102001445d04558a26b8ca04b486957c8abf5abf24ec76f0000110120a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be407f030100000b0008000000000000005d0004010100050201010100f140186a6bd413a50814db484b00398c2e7e6da9fbe2cb536728e880deb7506010027767f75fded47f94a6f81c671d448beddb6c2727f1f209ba015bf8de7331c13c100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018501030100002b002800000000002102eebd2f91818a234e1879f8a55652f1e52419ad168b8f27b91be6b79958f7a5510000030101002b00280100020000210214a91dfcb36718209a5ee79c290029b849f1ce2feef6585a3b3fa37d04fb62b7000010030102001e001b0200030200144ee490084160fc8b1e73361d5a4c055beee77d8c0000110120e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae4337f030100000b0008000000000000004f0004010100050201010100eb90b3c6d9a547e3b8a1111f621e0dbe5bfc68a8196371d497cb2912fa809d001002ab80ce7b6ca4875dbc7dc1f0d902551628c97b2383c27d04538d46a97d3cad43100146197ba2d1d89ae65f0e38b4207166d2b6d52014cc704c567082bf1dbd65f9df110201018701030100001e001b0000020300149a061f31734c5f5f0b119ab72d433c9af133d3a60000030101003a003701000101003096e1fc631934a14acd313ff28ca29c9e9b43181b8df29386702b1a2d65a7cc823683f5733e296fb40c73648bc9cbf625000010030102001e001b02000102001474f185aa527f31202442d208cdb2905fa71403290000110201609f06042003c1211aa9d26239c6dca1e6cb1dbb8266fe2b9500f8699c84aa90d623f7b1d3000b03fda4d93a40301700000095840c6be056ed3d199dedf5265a5d3dafd195aa4cb54ca26943f7e092a5f06904200f7e9f9896fecebab4c19d41e9d7f16c1727cd63d9db56f4d5b04322f29256cb000b03fd62132d410718000000b9dec92595e5eabb6de045782827bd98b60b9252287eec0f8e3450ea7c59619b1004201b240fcb4e632e7856bff58b784dcebc19398c734ec600c465fde95a2366dbeb000b03fd8e29761d5405000000380d1a8cb3511b3ecf770a1d81f40c293182d29cf0574962db50c4cfb626fdb711042035a8dd6a65ed429912d2db054462c7e8c011965aa76a76356a69b4c881808c30000b03fd62b9bfe135190000002eefa752386580c31084b54f2119973ccef6ac92fc38607e8609e896c9994c3e100420399474f653ba6b7b3839a43ed0fa35ffcddd5efa1d0e7082941bd6240c219f80000b03fdd0a1b7eee2140000002271b648a8925b8c717543453a59a3a20a3c52ce9b3e5fc793983c64f9f6fea004203eab8233e9132dbfc2b700abb64d5d46d843162f27199c92236c638522bbf3a2000b03fd1cb12a5b261400000068f31829eaec02f7e5eddada129d4981a99bda0e5c0fd4eff3c23eafc2c79a021004207f3dfd2ccb054f410ee77eb02ee7b4ea960795d89746cdc226ddd899e6ac4e51000b03fd586ba25d1f1a0000005e3b38a6d9bede250ed0b612d01915a78182ee18d819d07d43ae925728b42d2d11042097ac7c51f393e105bccc0998967f810df6138d5def08d6c27b7fb11790d3bdef000b03fd120b51f4ea10000000be380b13cfd7149332e5ac818ae84d31e4be119bc0ebd717475630f6f38b6e90100420a89ba1a7b2bd5b99fc1beee05aca5587ae3cfb4628d2a0358f208252b7e8be40000b03fd505d6c926f0d0000009500204c698cc12fc96774a34f77415c37376ff17b492838e414d774b5b7bec10420e8f1eaea303ab85c0a20dc6e80ba551e3fab2b85702319a122e550a8734ae433000b03fd1e078984690800000064d995f4b5b62c480a04f1b8fb4c7a30b607f12da4abc357993ee7505be19b26111111";
    char *pub_key_hash_one_hex = "1f0815269afc012de44260ceb28a4496d3184184";
    char *pub_key_hash_two_hex = "4463a1a994d5040e69c090b6985d7af295bfd11a";
    char *pub_key_hash_three_hex = "5e0e49d808ad21d01d07dd799a75bd1b472788a7";

    unsigned char *multiple_identity_proof_bin = hex2bin(multiple_identity_proof_hex);
    unsigned char *pub_key_hashes[3] = {
            hex2bin(pub_key_hash_one_hex),
            hex2bin(pub_key_hash_two_hex),
            hex2bin(pub_key_hash_three_hex),
    };
    MultipleIdentityIdVerificationResult *result = verify_identity_ids_by_public_key_hashes(multiple_identity_proof_bin, 6206, true, pub_key_hashes, 3);
    assert(result->is_valid);
    assert(result->map_size == 3);

    assert(result->public_key_hash_identity_id_map[0]->has_identity_id);
    assert(result->public_key_hash_identity_id_map[0]->id_size == 32);
    uint8_t expected_id_one[32] = {15, 126, 159, 152, 150, 254, 206, 186, 180, 193, 157, 65, 233, 215, 241, 108, 23,
                                   39, 205, 99, 217, 219, 86, 244, 213, 176, 67, 34, 242, 146, 86, 203};
    assert(is_array_equal(expected_id_one, result->public_key_hash_identity_id_map[0]->identity_id, result->public_key_hash_identity_id_map[0]->id_size));

    assert(result->public_key_hash_identity_id_map[1]->has_identity_id);
    assert(result->public_key_hash_identity_id_map[1]->id_size == 32);
    uint8_t expected_id_two[32] = {62, 171, 130, 51, 233, 19, 45, 191, 194, 183, 0, 171, 182, 77, 93, 70, 216, 67, 22,
                                   47, 39, 25, 156, 146, 35, 108, 99, 133, 34, 187, 243, 162};
    assert(is_array_equal(expected_id_two, result->public_key_hash_identity_id_map[1]->identity_id, result->public_key_hash_identity_id_map[0]->id_size));

    assert(result->public_key_hash_identity_id_map[2]->has_identity_id);
    assert(result->public_key_hash_identity_id_map[2]->id_size == 32);
    uint8_t expected_id_three[32] = {53, 168, 221, 106, 101, 237, 66, 153, 18, 210, 219, 5, 68, 98, 199, 232, 192, 17,
                                     150, 90, 167, 106, 118, 53, 106, 105, 180, 200, 129, 128, 140, 48,};
    assert(is_array_equal(expected_id_three, result->public_key_hash_identity_id_map[2]->identity_id, result->public_key_hash_identity_id_map[2]->id_size));
}


int main() {
    test_verify_full_identity_by_public_key_hash();
    test_verify_full_identities_by_public_key_hashes();
    test_verify_full_identity_by_identity_id();
    test_verify_identity_id_by_public_key_hash();
    test_verify_identity_balances_by_identity_ids();
    test_verify_identity_ids_by_public_key_hashes();

    printf("All assertions passed!!");
}
